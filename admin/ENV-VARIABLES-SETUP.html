<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🔧 EdgeOne Pages 环境变量配置详细指南</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .container {
            background: white;
            padding: 40px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        h1 { color: #dc3545; text-align: center; font-size: 2.5em; }
        h2 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 5px; }
        .alert {
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            font-size: 1.1em;
        }
        .alert-danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .step {
            background: #e9f5ff;
            border-left: 5px solid #007bff;
            padding: 20px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        .step h3 {
            color: #007bff;
            margin-top: 0;
        }
        .code {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }
        .env-var {
            background: #f8f9fa;
            border: 2px solid #007bff;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .env-var h4 {
            color: #007bff;
            margin-top: 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover { background: #0056b3; }
        .test-button {
            background: #28a745;
        }
        .test-button:hover { background: #218838; }
        .screenshot {
            border: 2px solid #dee2e6;
            border-radius: 8px;
            padding: 10px;
            background: #f8f9fa;
            margin: 15px 0;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🚨 环境变量配置紧急修复</h1>
        
        <div class="alert alert-danger">
            <strong>❌ 检测到环境变量缺失</strong><br>
            调试显示：<code>ADMIN_USERNAME: Missing</code>, <code>ADMIN_PASSWORD: Missing</code><br>
            这是导致身份验证失败的根本原因！
        </div>

        <h2>🎯 立即修复步骤</h2>
        
        <div class="step">
            <h3>第1步：登录EdgeOne Pages控制台</h3>
            <ol>
                <li>访问：<a href="https://edgeone.cloud.tencent.com/" target="_blank">https://edgeone.cloud.tencent.com/</a></li>
                <li>使用您的腾讯云账号登录</li>
                <li>选择"Pages"服务</li>
            </ol>
        </div>

        <div class="step">
            <h3>第2步：找到您的项目</h3>
            <ol>
                <li>在项目列表中找到项目：<strong>"company"</strong></li>
                <li>点击项目名称进入项目详情页</li>
            </ol>
            <div class="screenshot">
                <p><strong>📸 寻找项目名称："company"</strong></p>
                <p>（不是"company_web"，那是Gitee仓库名）</p>
            </div>
        </div>

        <div class="step">
            <h3>第3步：进入设置页面</h3>
            <ol>
                <li>在项目页面中，找到<strong>"设置"</strong>选项卡或按钮</li>
                <li>点击进入设置页面</li>
                <li>寻找<strong>"环境变量"</strong>或<strong>"Environment Variables"</strong>部分</li>
            </ol>
            <div class="screenshot">
                <p><strong>📸 可能的位置：</strong></p>
                <p>• 顶部导航栏的"设置"</p>
                <p>• 侧边栏的"环境变量"</p>
                <p>• "Functions"部分的"环境变量"</p>
            </div>
        </div>

        <div class="step">
            <h3>第4步：添加环境变量</h3>
            <p><strong>请精确添加以下三个环境变量：</strong></p>
            
            <div class="env-var">
                <h4>🔑 管理员用户名</h4>
                <div class="code">变量名称: ADMIN_USERNAME
变量值: xwteam</div>
                <p><strong>注意：</strong>变量名称必须完全匹配，区分大小写！</p>
            </div>

            <div class="env-var">
                <h4>🔐 管理员密码</h4>
                <div class="code">变量名称: ADMIN_PASSWORD
变量值: LuLu5201314</div>
                <p><strong>注意：</strong>这是您在调试中使用的密码，请确认正确！</p>
            </div>

            <div class="env-var">
                <h4>🔗 Gitee访问令牌</h4>
                <div class="code">变量名称: GITEE_TOKEN
变量值: 48eb317592d7a716e5cdc03411e51d37</div>
                <p><strong>注意：</strong>用于同步配置到Gitee仓库</p>
            </div>
        </div>

        <div class="step">
            <h3>第5步：保存并重新部署</h3>
            <ol>
                <li>保存所有环境变量</li>
                <li>触发项目重新部署：
                    <ul>
                        <li>方法1：在EdgeOne Pages中点击"重新部署"</li>
                        <li>方法2：向Gitee仓库推送一个小更改</li>
                    </ul>
                </li>
                <li>等待部署完成（通常1-3分钟）</li>
            </ol>
        </div>

        <h2>🧪 验证修复</h2>
        
        <div style="text-align: center; margin: 30px 0;">
            <button onclick="testEnvironmentVariables()" class="test-button">
                🔍 测试环境变量配置
            </button>
            <button onclick="window.open('debug-test.html', '_blank')">
                🛠️ 打开调试工具
            </button>
        </div>
        
        <div id="test-results"></div>

        <h2>❓ 常见问题解决</h2>
        
        <div class="alert alert-warning">
            <h4>Q: 找不到"环境变量"选项？</h4>
            <p><strong>A:</strong> 尝试以下位置：</p>
            <ul>
                <li>项目设置 → 构建与部署 → 环境变量</li>
                <li>Functions → 设置 → 环境变量</li>
                <li>部署 → 环境变量</li>
                <li>如果仍找不到，联系EdgeOne技术支持</li>
            </ul>
        </div>

        <div class="alert alert-warning">
            <h4>Q: 环境变量保存后仍显示"Missing"？</h4>
            <p><strong>A:</strong> 检查以下几点：</p>
            <ul>
                <li>变量名称是否完全匹配（区分大小写）</li>
                <li>是否已触发重新部署</li>
                <li>部署是否成功完成</li>
                <li>等待几分钟后重新测试</li>
            </ul>
        </div>

        <div class="alert alert-success">
            <h4>✅ 修复成功的标志</h4>
            <p>当环境变量正确配置后，您应该看到：</p>
            <ul>
                <li>/api/debug 端点正常工作（无需认证）</li>
                <li>环境变量显示为"Set"而不是"Missing"</li>
                <li>管理后台可以正常登录</li>
                <li>所有配置功能正常工作</li>
            </ul>
        </div>

        <div style="text-align: center; margin: 40px 0; padding: 20px; background: #e9f5ff; border-radius: 10px;">
            <h3 style="color: #007bff;">📞 需要帮助？</h3>
            <p>如果按照以上步骤操作后问题仍然存在，请：</p>
            <ol style="text-align: left; display: inline-block;">
                <li>运行调试工具并截图</li>
                <li>检查EdgeOne Pages项目设置截图</li>
                <li>确认是否有错误提示</li>
            </ol>
        </div>
    </div>

    <script>
        async function testEnvironmentVariables() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<div style="background: #d1ecf1; color: #0c5460; padding: 15px; border-radius: 6px;">🔍 正在测试环境变量...</div>';
            
            try {
                const response = await fetch('/api/debug');
                const data = await response.json();
                
                if (response.ok && data.environment) {
                    const env = data.environment;
                    let result = '<div style="padding: 20px; border-radius: 8px; margin: 15px 0;';
                    
                    if (env.adminUsername === 'Set' && env.adminPassword === 'Set') {
                        result += ' background: #d4edda; color: #155724;">✅ 环境变量配置成功！';
                        result += '<br><br><strong>状态：</strong>';
                        result += '<br>• ADMIN_USERNAME: ' + env.adminUsername;
                        result += '<br>• ADMIN_PASSWORD: ' + env.adminPassword;
                        result += '<br>• GITEE_TOKEN: ' + env.giteeToken;
                        result += '<br><br>🎉 现在可以正常登录管理后台了！';
                    } else {
                        result += ' background: #f8d7da; color: #721c24;">❌ 环境变量仍然缺失';
                        result += '<br><br><strong>当前状态：</strong>';
                        result += '<br>• ADMIN_USERNAME: ' + env.adminUsername;
                        result += '<br>• ADMIN_PASSWORD: ' + env.adminPassword;
                        result += '<br>• GITEE_TOKEN: ' + env.giteeToken;
                        result += '<br><br>请按照上述步骤重新配置环境变量。';
                    }
                    
                    result += '</div>';
                    resultsDiv.innerHTML = result;
                } else {
                    resultsDiv.innerHTML = '<div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 6px;">❌ 调试端点调用失败，请检查Functions部署状态</div>';
                }
            } catch (error) {
                resultsDiv.innerHTML = '<div style="background: #f8d7da; color: #721c24; padding: 15px; border-radius: 6px;">❌ 连接失败: ' + error.message + '</div>';
            }
        }
    </script>
</body>
</html>