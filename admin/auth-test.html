<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èº«ä»½éªŒè¯æµ‹è¯•å·¥å…·</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            max-width: 800px;
            margin: 40px auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }
        h1 { color: #007bff; text-align: center; }
        .form-group {
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #495057;
        }
        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
        }
        input:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
        }
        button:hover { background: #0056b3; }
        .results {
            margin-top: 20px;
            padding: 15px;
            border-radius: 6px;
            font-family: monospace;
        }
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” èº«ä»½éªŒè¯æµ‹è¯•å·¥å…·</h1>
        
        <div class="form-group">
            <label for="username">ç”¨æˆ·å</label>
            <input type="text" id="username" placeholder="è¾“å…¥æ‚¨çš„ç®¡ç†å‘˜ç”¨æˆ·å">
        </div>
        
        <div class="form-group">
            <label for="password">å¯†ç </label>
            <input type="password" id="password" placeholder="è¾“å…¥æ‚¨çš„ç®¡ç†å‘˜å¯†ç ">
        </div>
        
        <div style="text-align: center;">
            <button onclick="testAuth()">ğŸ§ª æµ‹è¯•èº«ä»½éªŒè¯</button>
            <button onclick="testBase64()">ğŸ”¤ æµ‹è¯•Base64ç¼–ç </button>
            <button onclick="checkLogs()">ğŸ“‹ æŸ¥çœ‹è°ƒè¯•ä¿¡æ¯</button>
        </div>
        
        <div id="results"></div>
    </div>

    <script>
        function showResult(message, type = 'info') {
            const resultsDiv = document.getElementById('results');
            const timestamp = new Date().toLocaleTimeString();
            resultsDiv.innerHTML = `
                <div class="${type}">
                    <strong>[${timestamp}]</strong><br>
                    ${message}
                </div>
            `;
        }

        function testBase64() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showResult('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ', 'error');
                return;
            }
            
            const credentials = `${username}:${password}`;
            const base64Credentials = btoa(credentials);
            const authHeader = `Basic ${base64Credentials}`;
            
            showResult(`
                <strong>Base64ç¼–ç æµ‹è¯•</strong><br>
                åŸå§‹å‡­æ®: ${credentials}<br>
                Base64ç¼–ç : ${base64Credentials}<br>
                Authorizationå¤´: ${authHeader}<br>
                <br>
                éªŒè¯è§£ç : ${atob(base64Credentials)}
            `, 'info');
        }

        async function testAuth() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            if (!username || !password) {
                showResult('è¯·è¾“å…¥ç”¨æˆ·åå’Œå¯†ç ', 'error');
                return;
            }
            
            showResult('æ­£åœ¨æµ‹è¯•èº«ä»½éªŒè¯...', 'info');
            
            try {
                const credentials = btoa(`${username}:${password}`);
                const response = await fetch('/api/configs', {
                    method: 'GET',
                    headers: {
                        'Authorization': `Basic ${credentials}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const responseText = await response.text();
                let responseData;
                
                try {
                    responseData = JSON.parse(responseText);
                } catch (e) {
                    responseData = responseText;
                }
                
                if (response.ok) {
                    showResult(`
                        <strong>âœ… èº«ä»½éªŒè¯æˆåŠŸï¼</strong><br>
                        çŠ¶æ€ç : ${response.status}<br>
                        å“åº”: ${JSON.stringify(responseData, null, 2)}
                    `, 'success');
                } else if (response.status === 401) {
                    showResult(`
                        <strong>âŒ èº«ä»½éªŒè¯å¤±è´¥</strong><br>
                        çŠ¶æ€ç : ${response.status}<br>
                        é”™è¯¯ä¿¡æ¯: ${responseData.message || responseData}<br>
                        <br>
                        <div class="debug-info">
                            <strong>è°ƒè¯•ä¿¡æ¯ï¼š</strong><br>
                            ç”¨æˆ·å: ${username}<br>
                            å¯†ç é•¿åº¦: ${password.length}<br>
                            Base64å‡­æ®: ${credentials}<br>
                            <br>
                            å¯èƒ½åŸå› ï¼š<br>
                            1. ç¯å¢ƒå˜é‡ ADMIN_USERNAME æˆ– ADMIN_PASSWORD æœªæ­£ç¡®é…ç½®<br>
                            2. ç”¨æˆ·åæˆ–å¯†ç ä¸åŒ¹é…<br>
                            3. EdgeOne Functionsä¸­Base64è§£ç é—®é¢˜
                        </div>
                    `, 'error');
                } else {
                    showResult(`
                        <strong>âš ï¸ æ„å¤–çš„å“åº”</strong><br>
                        çŠ¶æ€ç : ${response.status}<br>
                        å“åº”: ${JSON.stringify(responseData, null, 2)}
                    `, 'error');
                }
                
            } catch (error) {
                showResult(`
                    <strong>âŒ è¿æ¥é”™è¯¯</strong><br>
                    é”™è¯¯ä¿¡æ¯: ${error.message}<br>
                    <br>
                    è¿™é€šå¸¸æ„å‘³ç€ï¼š<br>
                    1. EdgeOne Functionsæœªæ­£ç¡®éƒ¨ç½²<br>
                    2. ç½‘ç»œè¿æ¥é—®é¢˜<br>
                    3. CORSé…ç½®é—®é¢˜
                `, 'error');
            }
        }

        function checkLogs() {
            showResult(`
                <strong>ğŸ“‹ å¦‚ä½•æŸ¥çœ‹EdgeOne Functionsè°ƒè¯•æ—¥å¿—ï¼š</strong><br>
                <br>
                1. ç™»å½• EdgeOne Pages æ§åˆ¶å°<br>
                2. è¿›å…¥é¡¹ç›® "company"<br>
                3. æ‰¾åˆ° "Functions" æˆ–"äº‘å‡½æ•°" é€‰é¡¹<br>
                4. æŸ¥çœ‹ "æ—¥å¿—" æˆ– "Logs" éƒ¨åˆ†<br>
                5. å¯»æ‰¾åŒ…å«è®¤è¯ä¿¡æ¯çš„æ—¥å¿—<br>
                <br>
                <strong>é¢„æœŸçœ‹åˆ°çš„æ—¥å¿—ï¼š</strong><br>
                â€¢ Auth header received: Present<br>
                â€¢ Base64 credentials length: XX<br>
                â€¢ Decoded credentials format: Valid<br>
                â€¢ Parsed username: ${document.getElementById('username').value || 'your_username'}<br>
                â€¢ Environment - Username: Set, Password: Set<br>
                â€¢ Auth validation result: true/false<br>
                <br>
                å¦‚æœçœ‹åˆ° "Environment - Username: Missing" æˆ– "Password: Missing"ï¼Œ<br>
                è¯´æ˜ç¯å¢ƒå˜é‡é…ç½®æœ‰é—®é¢˜ã€‚
            `, 'info');
        }
    </script>
</body>
</html>