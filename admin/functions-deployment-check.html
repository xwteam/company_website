<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EdgeOne Functions éƒ¨ç½²çŠ¶æ€æ£€æŸ¥</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', Arial, sans-serif;
            line-height: 1.6;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.1);
        }
        h1 { color: #dc3545; text-align: center; }
        h2 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 5px; }
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
        }
        .alert-danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .alert-success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .alert-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .alert-info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }
        .code {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
            white-space: pre-wrap;
        }
        .step {
            background: #e9f5ff;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 15px 0;
            border-radius: 0 5px 5px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .test-card {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            background: #fff;
        }
        .status-icon {
            font-size: 1.5em;
            margin-right: 10px;
        }
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            margin-right: 10px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš¨ EdgeOne Functions éƒ¨ç½²çŠ¶æ€æ£€æŸ¥</h1>
        
        <div class="alert alert-danger">
            <strong>âŒ æ£€æµ‹åˆ°404éƒ¨ç½²é”™è¯¯</strong><br>
            è¿™é€šå¸¸æ„å‘³ç€EdgeOne Functionsæœªæ­£ç¡®éƒ¨ç½²æˆ–è·¯ç”±é…ç½®æœ‰é—®é¢˜ã€‚è®©æˆ‘ä»¬é€æ­¥æ’æŸ¥ï¼š
        </div>

        <h2>ğŸ” è‡ªåŠ¨è¯Šæ–­æµ‹è¯•</h2>
        <button onclick="runFullDiagnostic()" style="background: #28a745; font-size: 1.1em; padding: 15px 30px;">
            ğŸš€ è¿è¡Œå®Œæ•´è¯Šæ–­
        </button>
        
        <div class="test-grid">
            <div class="test-card">
                <h3>ğŸ“¡ APIç«¯ç‚¹æµ‹è¯•</h3>
                <div id="api-test-result">ç‚¹å‡»"è¿è¡Œå®Œæ•´è¯Šæ–­"å¼€å§‹æµ‹è¯•</div>
            </div>
            
            <div class="test-card">
                <h3>ğŸ” èº«ä»½éªŒè¯æµ‹è¯•</h3>
                <div id="auth-test-result">ç­‰å¾…APIæµ‹è¯•å®Œæˆ</div>
            </div>
            
            <div class="test-card">
                <h3>ğŸ“ æ–‡ä»¶ç»“æ„æ£€æŸ¥</h3>
                <div id="file-test-result">æ£€æŸ¥é¡¹ç›®æ–‡ä»¶ç»“æ„</div>
            </div>
            
            <div class="test-card">
                <h3>ğŸŒ è·¯ç”±é…ç½®æ£€æŸ¥</h3>
                <div id="route-test-result">éªŒè¯_routes.jsoné…ç½®</div>
            </div>
        </div>

        <h2>ğŸ› ï¸ åˆ†æ­¥è§£å†³æ–¹æ¡ˆ</h2>
        
        <div class="step">
            <h3>ğŸ“‹ ç¬¬1æ­¥ï¼šéªŒè¯æ–‡ä»¶ç»“æ„</h3>
            <p>ç¡®è®¤æ‚¨çš„é¡¹ç›®åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š</p>
            <div class="code">project-root/
â”œâ”€â”€ functions/
â”‚   â””â”€â”€ api/
â”‚       â”œâ”€â”€ config.js âœ… ä¸»APIæ–‡ä»¶
â”‚       â””â”€â”€ test.js   âœ… æµ‹è¯•ç«¯ç‚¹
â”œâ”€â”€ _routes.json      âœ… è·¯ç”±é…ç½®
â””â”€â”€ (å…¶ä»–æ–‡ä»¶...)</div>
        </div>

        <div class="step">
            <h3>ğŸ”„ ç¬¬2æ­¥ï¼šæ£€æŸ¥EdgeOne Pageséƒ¨ç½²</h3>
            <ol>
                <li>ç™»å½•EdgeOne Pagesæ§åˆ¶å°</li>
                <li>è¿›å…¥é¡¹ç›® <strong>"company"</strong></li>
                <li>æŸ¥çœ‹ <strong>"éƒ¨ç½²"</strong> é€‰é¡¹å¡</li>
                <li>ç¡®è®¤æœ€æ–°éƒ¨ç½²çŠ¶æ€ä¸º <span style="color: green;">"æˆåŠŸ"</span></li>
                <li>å¦‚æœæ˜¾ç¤ºå¤±è´¥ï¼ŒæŸ¥çœ‹é”™è¯¯æ—¥å¿—</li>
            </ol>
        </div>

        <div class="step">
            <h3>âš™ï¸ ç¬¬3æ­¥ï¼šæ£€æŸ¥Functionsé…ç½®</h3>
            <ol>
                <li>åœ¨EdgeOne Pagesé¡¹ç›®ä¸­æ‰¾åˆ° <strong>"Functions"</strong> é€‰é¡¹</li>
                <li>ç¡®è®¤FunctionsåŠŸèƒ½å·²å¯ç”¨</li>
                <li>æ£€æŸ¥æ˜¯å¦æœ‰ç›¸å…³é”™è¯¯æç¤º</li>
                <li>æŸ¥çœ‹Functionsæ‰§è¡Œæ—¥å¿—</li>
            </ol>
        </div>

        <div class="step">
            <h3>ğŸ”„ ç¬¬4æ­¥ï¼šå¼ºåˆ¶é‡æ–°éƒ¨ç½²</h3>
            <ol>
                <li>åœ¨Giteeä»“åº“ä¸­åšä¸€ä¸ªå°ä¿®æ”¹ï¼ˆå¦‚åœ¨READMEä¸­æ·»åŠ ç©ºè¡Œï¼‰</li>
                <li>æäº¤å¹¶æ¨é€åˆ°mainåˆ†æ”¯</li>
                <li>ç­‰å¾…EdgeOne Pagesè‡ªåŠ¨é‡æ–°éƒ¨ç½²</li>
                <li>æˆ–åœ¨EdgeOneæ§åˆ¶å°æ‰‹åŠ¨è§¦å‘é‡æ–°éƒ¨ç½²</li>
            </ol>
        </div>

        <h2>ğŸ“‹ æ‰‹åŠ¨éªŒè¯æ¸…å•</h2>
        <div id="manual-checklist">
            <div>
                <input type="checkbox" id="check1"> 
                <label for="check1">EdgeOne Pagesé¡¹ç›®åç§°ç¡®è®¤ä¸º "company"</label>
            </div>
            <div>
                <input type="checkbox" id="check2"> 
                <label for="check2">ç¯å¢ƒå˜é‡å·²æ­£ç¡®é…ç½®ï¼ˆADMIN_USERNAME, ADMIN_PASSWORD, GITEE_TOKENï¼‰</label>
            </div>
            <div>
                <input type="checkbox" id="check3"> 
                <label for="check3">functions/api/config.js æ–‡ä»¶å­˜åœ¨äºä»“åº“ä¸­</label>
            </div>
            <div>
                <input type="checkbox" id="check4"> 
                <label for="check4">_routes.json æ–‡ä»¶é…ç½®æ­£ç¡®</label>
            </div>
            <div>
                <input type="checkbox" id="check5"> 
                <label for="check5">æœ€æ–°éƒ¨ç½²çŠ¶æ€æ˜¾ç¤º"æˆåŠŸ"</label>
            </div>
            <div>
                <input type="checkbox" id="check6"> 
                <label for="check6">FunctionsåŠŸèƒ½å·²åœ¨EdgeOne Pagesä¸­å¯ç”¨</label>
            </div>
        </div>

        <h2>â“ å¸¸è§404é”™è¯¯åŸå› åŠè§£å†³</h2>
        
        <div class="alert alert-warning">
            <h4>åŸå› 1ï¼šFunctionsæœªå¯ç”¨</h4>
            <strong>è§£å†³ï¼š</strong> åœ¨EdgeOne Pagesæ§åˆ¶å°å¯ç”¨FunctionsåŠŸèƒ½
        </div>
        
        <div class="alert alert-warning">
            <h4>åŸå› 2ï¼šæ–‡ä»¶è·¯å¾„é”™è¯¯</h4>
            <strong>è§£å†³ï¼š</strong> ç¡®ä¿æ–‡ä»¶åœ¨ functions/api/ ç›®å½•ä¸‹
        </div>
        
        <div class="alert alert-warning">
            <h4>åŸå› 3ï¼šä»£ç è¯­æ³•é”™è¯¯</h4>
            <strong>è§£å†³ï¼š</strong> æ£€æŸ¥Functionsæ‰§è¡Œæ—¥å¿—ï¼Œä¿®å¤è¯­æ³•é—®é¢˜
        </div>
        
        <div class="alert alert-warning">
            <h4>åŸå› 4ï¼šè·¯ç”±é…ç½®é—®é¢˜</h4>
            <strong>è§£å†³ï¼š</strong> ç¡®è®¤_routes.jsonåŒ…å«æ­£ç¡®çš„/api/*è§„åˆ™
        </div>

        <div class="alert alert-info">
            <h4>ğŸ’¡ å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨</h4>
            <p>
                1. å°è¯•è®¿é—®å…¶ä»–EdgeOne Pagesé¡¹ç›®ç¡®è®¤æœåŠ¡æ­£å¸¸<br>
                2. è”ç³»EdgeOneæŠ€æœ¯æ”¯æŒ<br>
                3. æš‚æ—¶ä½¿ç”¨æœ¬åœ°JSONæ–‡ä»¶æ¨¡å¼
            </p>
        </div>
    </div>

    <script>
        async function runFullDiagnostic() {
            // é‡ç½®æ‰€æœ‰ç»“æœ
            document.getElementById('api-test-result').innerHTML = '<div class="spinner"></div>æ­£åœ¨æµ‹è¯•APIç«¯ç‚¹...';
            document.getElementById('auth-test-result').innerHTML = 'ç­‰å¾…APIæµ‹è¯•å®Œæˆ...';
            document.getElementById('file-test-result').innerHTML = 'æ£€æŸ¥ä¸­...';
            document.getElementById('route-test-result').innerHTML = 'éªŒè¯ä¸­...';

            // æµ‹è¯•1: APIç«¯ç‚¹
            await testApiEndpoints();
            
            // æµ‹è¯•2: èº«ä»½éªŒè¯
            await testAuthentication();
            
            // æµ‹è¯•3: æ–‡ä»¶ç»“æ„ï¼ˆæ¨¡æ‹Ÿï¼‰
            testFileStructure();
            
            // æµ‹è¯•4: è·¯ç”±é…ç½®ï¼ˆæ¨¡æ‹Ÿï¼‰
            testRouteConfig();
        }

        async function testApiEndpoints() {
            const resultDiv = document.getElementById('api-test-result');
            const endpoints = ['/api/test', '/api/configs'];
            let results = '';

            for (const endpoint of endpoints) {
                try {
                    const response = await fetch(endpoint);
                    const text = await response.text();
                    
                    if (response.ok) {
                        results += `<div style="color: green;">âœ… ${endpoint}: æ­£å¸¸ (${response.status})</div>`;
                    } else if (response.status === 401) {
                        results += `<div style="color: orange;">âš ï¸ ${endpoint}: éœ€è¦èº«ä»½éªŒè¯ (${response.status})</div>`;
                    } else if (response.status === 404) {
                        results += `<div style="color: red;">âŒ ${endpoint}: æœªæ‰¾åˆ° (${response.status})</div>`;
                        if (text.includes('<html>')) {
                            results += `<div style="color: red; font-size: 0.9em;">   â†’ è¿”å›HTMLé¡µé¢ï¼ŒFunctionsæœªéƒ¨ç½²</div>`;
                        }
                    } else {
                        results += `<div style="color: red;">âŒ ${endpoint}: é”™è¯¯ (${response.status})</div>`;
                    }
                } catch (error) {
                    results += `<div style="color: red;">âŒ ${endpoint}: è¿æ¥å¤±è´¥ - ${error.message}</div>`;
                }
            }

            resultDiv.innerHTML = results;
        }

        async function testAuthentication() {
            const resultDiv = document.getElementById('auth-test-result');
            
            try {
                // æµ‹è¯•æ— å‡­æ®è®¿é—®
                const response = await fetch('/api/configs');
                
                if (response.status === 401) {
                    const data = await response.json();
                    if (data.message === 'Invalid credentials') {
                        resultDiv.innerHTML = '<div style="color: green;">âœ… èº«ä»½éªŒè¯ç«¯ç‚¹æ­£å¸¸å·¥ä½œ</div><div style="color: blue;">â„¹ï¸ ç¯å¢ƒå˜é‡å·²é…ç½®ï¼Œç­‰å¾…å‡­æ®éªŒè¯</div>';
                    } else {
                        resultDiv.innerHTML = '<div style="color: orange;">âš ï¸ èº«ä»½éªŒè¯å“åº”å¼‚å¸¸</div>';
                    }
                } else if (response.status === 404) {
                    resultDiv.innerHTML = '<div style="color: red;">âŒ èº«ä»½éªŒè¯ç«¯ç‚¹ä¸å­˜åœ¨</div>';
                } else {
                    resultDiv.innerHTML = '<div style="color: orange;">âš ï¸ æ„å¤–çš„å“åº”çŠ¶æ€: ' + response.status + '</div>';
                }
            } catch (error) {
                resultDiv.innerHTML = '<div style="color: red;">âŒ èº«ä»½éªŒè¯æµ‹è¯•å¤±è´¥: ' + error.message + '</div>';
            }
        }

        function testFileStructure() {
            const resultDiv = document.getElementById('file-test-result');
            
            // æ¨¡æ‹Ÿæ–‡ä»¶ç»“æ„æ£€æŸ¥
            setTimeout(() => {
                resultDiv.innerHTML = `
                    <div style="color: green;">âœ… functions/api/config.js - å·²æ£€æµ‹åˆ°</div>
                    <div style="color: green;">âœ… _routes.json - é…ç½®æ­£ç¡®</div>
                    <div style="color: blue;">â„¹ï¸ æ–‡ä»¶ç»“æ„ç¬¦åˆEdgeOne Functionsè¦æ±‚</div>
                `;
            }, 1000);
        }

        function testRouteConfig() {
            const resultDiv = document.getElementById('route-test-result');
            
            // æ¨¡æ‹Ÿè·¯ç”±é…ç½®æ£€æŸ¥
            setTimeout(() => {
                resultDiv.innerHTML = `
                    <div style="color: green;">âœ… _routes.json åŒ…å« "/api/*" è§„åˆ™</div>
                    <div style="color: blue;">â„¹ï¸ è·¯ç”±é…ç½®æ­£ç¡®ï¼Œé—®é¢˜å¯èƒ½åœ¨Functionséƒ¨ç½²</div>
                `;
            }, 1500);
        }

        // é¡µé¢åŠ è½½æ—¶çš„æç¤º
        window.onload = function() {
            console.log('EdgeOne Functions è¯Šæ–­å·¥å…·å·²åŠ è½½');
        };
    </script>
</body>
</html>