<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brand - Digital Experiences with Purpose</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/responsive.css">
    <link rel="stylesheet" href="css/fontawesome/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- 导航栏 -->
    <header>
        <div class="container">
            <div class="logo">
                <a href="index.html">Brand</a>
            </div>
            <nav>
                <ul>
                    <li><a href="index.html" class="active">Home</a></li>
                    <li><a href="products.html">Products</a></li>
                    <li><a href="services.html">Services</a></li>
                    <li><a href="partners.html">Partners</a></li>
                    <li><a href="about.html">About</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li><a href="admin.html">Admin</a></li>
                </ul>
            </nav>
            <div class="mobile-menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
            <div class="header-cta">
                <a href="contact.html" class="btn primary">Get in Touch</a>
            </div>
        </div>
    </header>

    <!-- 英雄区域 -->
    <section class="hero">
        <div id="hero-bg" class="hero-bg"></div>
        <div class="hero-bg-overlay"></div>
        <div class="container">
            <div class="hero-content">
                <h1 id="hero-title">Crafting digital<br>experiences with purpose</h1>
                <p id="hero-description">Strategy-driven design and technology for forward-thinking brands</p>
                <div class="cta-buttons">
                    <a href="products.html" class="btn primary">View Our Products</a>
                    <a href="contact.html" class="btn secondary">Work With Us</a>
                </div>
            </div>
        </div>
    </section>

    <!-- 服务介绍 -->
    <section class="services">
        <div class="container">
            <h2>Our Services</h2>
            <p id="services-description" class="section-description">We combine strategy, design, and technology to create effective digital solutions</p>
            
            <div id="services-grid" class="services-grid">
                <!-- 服务卡片将通过JavaScript动态生成 -->
            </div>
        </div>
    </section>

    <!-- 精选项目 -->
    <section class="featured-projects">
        <div class="container">
            <h2>Featured Products</h2>
            <p id="featured-products-description" class="section-description">A selection of our quality products across categories</p>
            
            <div class="projects-grid">
                <div class="project-card">
                    <div class="project-image">
                        <img src="images/project-1.jpg" alt="Financial Platform Project">
                        <div class="project-category">Web Development</div>
                    </div>
                    <div class="project-info">
                        <h3>Nova Finance Platform</h3>
                        <p>A modern banking interface with advanced analytics and personalized insights</p>
                        <div class="project-tags">
                            <span>React</span>
                            <span>TypeScript</span>
                            <span>Financial</span>
                        </div>
                    </div>
                </div>
                
                <div class="project-card">
                    <div class="project-image">
                        <img src="images/project-2.jpg" alt="Eco Habitat Branding">
                        <div class="project-category">Brand Identity</div>
                    </div>
                    <div class="project-info">
                        <h3>Eco Habitat</h3>
                        <p>Complete brand identity for a sustainable housing initiative focused on eco-friendly living</p>
                        <div class="project-tags">
                            <span>Branding</span>
                            <span>Sustainability</span>
                        </div>
                    </div>
                </div>
                
                <div class="project-card">
                    <div class="project-image">
                        <img src="images/project-3.jpg" alt="Urban Mobility App">
                        <div class="project-category">UX Design</div>
                    </div>
                    <div class="project-info">
                        <h3>CityMove</h3>
                        <p>User-centered mobility app that integrates public transit, ride-sharing, and micro-mobility options</p>
                        <div class="project-tags">
                            <span>Mobile</span>
                            <span>UX/UI</span>
                            <span>Transportation</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="section-cta">
                <a href="products.html" class="btn primary">View All Products</a>
            </div>
        </div>
    </section>

    <!-- 客户评价 -->
    <section class="testimonials">
        <div class="container">
            <h2>Client Testimonials</h2>
            <p id="testimonials-description" class="section-description">Hear from the businesses we have helped transform</p>
            
            <div id="testimonials-carousel" class="testimonials-carousel">
                <!-- 客户评价将通过JavaScript动态生成 -->
            </div>
            
            <div id="carousel-indicators" class="carousel-indicators">
                <!-- 轮播指示器将通过JavaScript动态生成 -->
            </div>
        </div>
    </section>

    <!-- 页脚 -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <a href="index.html">Brand</a>
                    <p>Creating digital experiences with purpose since 2010</p>
                </div>
                
                <div class="footer-links">
                    <div class="footer-links-column">
                        <h3>Pages</h3>
                        <ul>
                            <li><a href="index.html">Home</a></li>
                            <li><a href="products.html">Products</a></li>
                            <li><a href="services.html">Services</a></li>
                            <li><a href="partners.html">Partners</a></li>
                            <li><a href="about.html">About</a></li>
                            <li><a href="contact.html">Contact</a></li>
                        </ul>
                    </div>
                    
                    <div class="footer-links-column">
                        <h3>Services</h3>
                        <ul>
                            <li><a href="services.html">Brand Identity</a></li>
                            <li><a href="services.html">Web Development</a></li>
                            <li><a href="services.html">UX Design</a></li>
                            <li><a href="services.html">Digital Marketing</a></li>
                        </ul>
                    </div>
                    
                    <div class="footer-links-column">
                        <h3>Contact</h3>
                        <ul>
                            <li><a href="mailto:hello@brand.com">hello@brand.com</a></li>
                            <li><a href="tel:+1234567890">+1 (234) 567-890</a></li>
                            <li>123 Design Street<br>Creative City, 10001</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <div class="footer-bottom">
                <div class="copyright">
                    &copy; 2023 Brand. All rights reserved.
                </div>
                <div class="social-links">
                    <a href="#"><i class="fab fa-twitter"></i></a>
                    <a href="#"><i class="fab fa-facebook-f"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-linkedin-in"></i></a>
                </div>
            </div>
        </div>
    </footer>

    <script src="js/kv-init.js"></script>
    <script src="js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 当前轮播索引
            let currentTestimonialIndex = 0;
            
            // 轮播项目数组
            let testimonialItems = [];
            
            // 为轮播容器添加鼠标滚轮事件监听器
            document.getElementById('testimonials-carousel').addEventListener('wheel', function(event) {
                event.preventDefault();
                
                if (event.deltaY > 0) {
                    // 向下滚动，显示下一个
                    currentTestimonialIndex = (currentTestimonialIndex + 1) % testimonialItems.length;
                } else {
                    // 向上滚动，显示上一个
                    currentTestimonialIndex = (currentTestimonialIndex - 1 + testimonialItems.length) % testimonialItems.length;
                }
                
                updateTestimonialCarousel();
            });
            
            // 异步函数，从KV存储加载配置
            async function loadConfig() {
                console.log("开始加载配置...", new Date().toISOString());
                
                // 检查URL中是否有强制刷新参数
                const urlParams = new URLSearchParams(window.location.search);
                const forceRefresh = urlParams.has('refresh');
                if (forceRefresh) {
                    console.log("强制刷新模式，清除所有缓存");
                    // 清除stella缓存
                    if (typeof stella !== 'undefined') {
                        stella.clearCache();
                    }
                }
                
                // 预先显示默认内容，避免白屏
                preRenderDefaultContent();
                
                try {
                    // 使用EdgeOne Pages的KV存储API获取配置
                    const config = {};
                    
                    // 首先尝试使用API端点获取配置
                    try {
                        // 添加时间戳参数避免缓存
                        const timestamp = new Date().getTime();
                        console.log(`尝试从API端点加载配置: /api/kv/config?t=${timestamp}`);
                        
                        const response = await fetch(`/api/kv/config?t=${timestamp}`, {
                            method: 'GET',
                            headers: {
                                'Cache-Control': 'no-cache, no-store, must-revalidate',
                                'Pragma': 'no-cache',
                                'Expires': '0'
                            },
                            credentials: 'same-origin'
                        });
                        
                        console.log("API响应状态:", response.status, response.statusText);
                        
                        if (response.ok) {
                            const data = await response.json();
                            console.log("API响应数据:", data);
                            
                            if (data.value) {
                                // 如果API返回了完整配置，直接使用
                                const fullConfig = typeof data.value === 'string' ? JSON.parse(data.value) : data.value;
                                console.log("从API端点加载完整配置成功:", fullConfig);
                                
                                // 应用配置
                                applyConfig(fullConfig);
                                
                                // 显示成功消息
                                showSuccess("配置加载成功！");
                                
                                return;
                            } else {
                                console.warn("API响应中没有找到value字段");
                            }
                        } else {
                            console.warn("API响应不成功:", response.status, response.statusText);
                        }
                    } catch (apiError) {
                        console.error("从API端点加载完整配置失败:", apiError);
                    }
                    
                    // 如果API端点未返回完整配置，则尝试使用stella对象并行加载各个配置项
                    if (typeof stella !== 'undefined') {
                        console.log("使用stella对象并行加载配置...");
                        
                        try {
                            // 并行获取各个配置项
                            const promises = [
                                stella.get('hero-bg', 'text'),
                                stella.get('hero-content-title', 'text'),
                                stella.get('hero-content-description', 'text'),
                                stella.get('services-description', 'json'),
                                stella.get('featured-products-description', 'text'),
                                stella.get('testimonials-description', 'json')
                            ];
                            
                            const [heroBg, heroTitle, heroDesc, servicesDesc, featuredProductsDesc, testimonialsDesc] = await Promise.all(promises);
                            
                            // 组合配置
                            config['hero-bg'] = heroBg;
                            config['hero-content-title'] = heroTitle;
                            config['hero-content-description'] = heroDesc;
                            config['services-description'] = servicesDesc;
                            config['featured-products-description'] = featuredProductsDesc;
                            config['testimonials-description'] = testimonialsDesc;
                            
                            console.log("配置加载成功:", config);
                            
                            // 应用配置
                            applyConfig(config);
                            
                            // 显示成功消息
                            showSuccess("配置加载成功！");
                        } catch (stellaError) {
                            console.error("使用stella对象加载配置失败:", stellaError);
                            throw stellaError;
                        }
                    } else {
                        throw new Error("stella对象未定义，无法加载配置");
                    }
                } catch (error) {
                    console.error(`加载配置失败:`, error);
                    showError("配置加载失败。请确保KV存储已正确配置，或联系网站管理员。错误详情: " + error.message);
                }
            }
            
            // 预渲染默认内容
            function preRenderDefaultContent() {
                // 设置默认hero背景
                document.getElementById('hero-bg').style.backgroundImage = `url('images/hero-bg.jpg')`;
                
                // 设置默认hero标题和描述
                document.getElementById('hero-title').innerHTML = 'Crafting digital<br>experiences with purpose';
                document.getElementById('hero-description').textContent = 'Strategy-driven design and technology for forward-thinking brands';
                
                // 设置默认服务描述
                document.getElementById('services-description').textContent = 'We combine strategy, design, and technology to create effective digital solutions';
                
                // 设置默认服务卡片
                const defaultServices = [
                    {
                        icon: 'fas fa-globe',
                        title: 'Brand Identity',
                        desc: 'We create unique visual systems that embody your brand values'
                    },
                    {
                        icon: 'fas fa-code',
                        title: 'Web Development',
                        desc: 'Custom websites and applications built with modern technologies'
                    },
                    {
                        icon: 'fas fa-mobile-alt',
                        title: 'UX Design',
                        desc: 'User-centered design that delivers intuitive digital experiences'
                    }
                ];
                
                const servicesGrid = document.getElementById('services-grid');
                servicesGrid.innerHTML = ''; // 清空现有内容
                
                defaultServices.forEach(item => {
                    const serviceCard = document.createElement('div');
                    serviceCard.className = 'service-card';
                    
                    serviceCard.innerHTML = `
                        <div class="service-icon">
                            <i class="${item.icon}"></i>
                        </div>
                        <h3>${item.title}</h3>
                        <p>${item.desc}</p>
                    `;
                    
                    servicesGrid.appendChild(serviceCard);
                });
                
                // 设置默认产品描述
                document.getElementById('featured-products-description').textContent = 'A selection of our quality products across categories';
                
                // 设置默认testimonials描述
                document.getElementById('testimonials-description').textContent = 'Hear from the businesses we have helped transform';
            }
            
            // 显示错误信息
            function showError(message) {
                // 移除任何现有的错误消息
                const existingError = document.querySelector('.error-message');
                if (existingError) existingError.remove();
                
                // 创建新的错误消息
                const errorMessage = document.createElement('div');
                errorMessage.className = 'error-message';
                errorMessage.innerHTML = `
                    <div class="container">
                        <div class="alert alert-danger">
                            <h3>配置加载失败</h3>
                            <p>${message}</p>
                            <div class="error-actions">
                                <button onclick="window.location.reload()" class="btn primary">刷新页面</button>
                                <button onclick="forceRefreshPage()" class="btn secondary">强制刷新</button>
                                <button onclick="window.location.href='admin.html'" class="btn secondary">管理配置</button>
                                <button onclick="window.location.href='kv-test.html'" class="btn secondary">测试KV连接</button>
                            </div>
                        </div>
                    </div>
                `;
                document.body.insertBefore(errorMessage, document.body.firstChild);
            }
            
            // 强制刷新页面，清除所有缓存
            function forceRefreshPage() {
                if (typeof stella !== 'undefined' && typeof stella.forceRefresh === 'function') {
                    stella.forceRefresh();
                } else {
                    const currentUrl = new URL(window.location.href);
                    currentUrl.searchParams.set('refresh', Date.now());
                    window.location.href = currentUrl.toString();
                }
            }
            
            // 显示成功信息
            function showSuccess(message) {
                // 移除任何现有的成功消息
                const existingSuccess = document.querySelector('.success-message');
                if (existingSuccess) existingSuccess.remove();
                
                // 创建新的成功消息
                const successMessage = document.createElement('div');
                successMessage.className = 'success-message';
                successMessage.innerHTML = `
                    <div class="container">
                        <div class="alert alert-success">
                            <p>${message}</p>
                        </div>
                    </div>
                `;
                document.body.insertBefore(successMessage, document.body.firstChild);
                
                // 3秒后自动隐藏成功消息
                setTimeout(() => {
                    const msg = document.querySelector('.success-message');
                    if (msg) {
                        msg.style.opacity = '0';
                        setTimeout(() => msg.remove(), 500);
                    }
                }, 3000);
            }
            
            // 应用配置到页面
            function applyConfig(config) {
                // 设置hero背景
                if (config['hero-bg']) {
                    console.log("Setting background to:", config['hero-bg']);
                    document.getElementById('hero-bg').style.backgroundImage = `url('${config['hero-bg']}')`;
                }
                
                // 设置hero标题
                if (config['hero-content-title']) {
                    console.log("Setting title to:", config['hero-content-title']);
                    document.getElementById('hero-title').innerHTML = config['hero-content-title'];
                }
                
                // 设置hero描述
                if (config['hero-content-description']) {
                    console.log("Setting description to:", config['hero-content-description']);
                    document.getElementById('hero-description').textContent = config['hero-content-description'];
                }
                
                // 设置services描述和卡片
                if (config['services-description']) {
                    console.log("Setting services data:", config['services-description']);
                    
                    // 设置服务描述标题
                    if (config['services-description'].title) {
                        document.getElementById('services-description').textContent = config['services-description'].title;
                    }
                    
                    // 生成服务卡片
                    if (config['services-description'].items && Array.isArray(config['services-description'].items)) {
                        const servicesGrid = document.getElementById('services-grid');
                        servicesGrid.innerHTML = ''; // 清空现有内容
                        
                        config['services-description'].items.forEach(item => {
                            const serviceCard = document.createElement('div');
                            serviceCard.className = 'service-card';
                            
                            serviceCard.innerHTML = `
                                <div class="service-icon">
                                    <i class="${item.icon || 'fas fa-star'}"></i>
                                </div>
                                <h3>${item.title || ''}</h3>
                                <p>${item.desc || ''}</p>
                            `;
                            
                            servicesGrid.appendChild(serviceCard);
                        });
                    }
                }
                
                // 设置featured products描述
                if (config['featured-products-description']) {
                    console.log("Setting featured products description to:", config['featured-products-description']);
                    document.getElementById('featured-products-description').textContent = config['featured-products-description'];
                }
                
                // 设置testimonials描述和轮播
                if (config['testimonials-description']) {
                    console.log("Setting testimonials data:", config['testimonials-description']);
                    
                    // 设置评价描述标题
                    if (config['testimonials-description'].title) {
                        document.getElementById('testimonials-description').textContent = config['testimonials-description'].title;
                    }
                    
                    // 生成客户评价轮播
                    if (config['testimonials-description'].items && Array.isArray(config['testimonials-description'].items)) {
                        testimonialItems = config['testimonials-description'].items;
                        initTestimonialsCarousel();
                    }
                }
            }
            
            // 初始化客户评价轮播
            function initTestimonialsCarousel() {
                if (testimonialItems.length === 0) return;
                
                console.log("Initializing testimonial carousel with", testimonialItems.length, "items:", testimonialItems);
                
                const carousel = document.getElementById('testimonials-carousel');
                const indicators = document.getElementById('carousel-indicators');
                
                // 创建指示器
                indicators.innerHTML = '';
                testimonialItems.forEach((item, index) => {
                    console.log(`Creating indicator for item ${index}:`, item.name);
                    const indicator = document.createElement('span');
                    indicator.className = 'carousel-dot';
                    if (index === 0) indicator.classList.add('active');
                    indicator.addEventListener('click', () => {
                        currentTestimonialIndex = index;
                        updateTestimonialCarousel();
                    });
                    indicators.appendChild(indicator);
                });
                
                // 初始显示第一个评价
                updateTestimonialCarousel();
                
                // 设置自动轮播
                setInterval(() => {
                    currentTestimonialIndex = (currentTestimonialIndex + 1) % testimonialItems.length;
                    console.log("Auto-advancing to testimonial", currentTestimonialIndex);
                    updateTestimonialCarousel();
                }, 5000);
            }
            
            // 更新轮播显示
            function updateTestimonialCarousel() {
                if (testimonialItems.length === 0) return;
                
                console.log("Updating carousel to show item", currentTestimonialIndex, "of", testimonialItems.length);
                
                const item = testimonialItems[currentTestimonialIndex];
                console.log("Current testimonial:", item);
                
                const carousel = document.getElementById('testimonials-carousel');
                
                // 更新轮播内容
                const testimonialContent = document.createElement('div');
                testimonialContent.className = 'testimonial-content';
                
                // 检查是否有自定义头像
                const avatarUrl = item.avatar || 'images/default-avatar.jpg';
                console.log("Using avatar:", avatarUrl);
                
                testimonialContent.innerHTML = `
                    <div class="testimonial-quote">
                        <i class="fas fa-quote-left"></i>
                    </div>
                    <p>${item.quote}</p>
                    <div class="client-info">
                        <div class="client-image">
                            <img src="${avatarUrl}" alt="${item.name}">
                        </div>
                        <div class="client-details">
                            <h4>${item.name}</h4>
                            <p>${item.position}</p>
                        </div>
                    </div>
                `;
                
                // 替换现有内容
                const existingContent = carousel.querySelector('.testimonial-content');
                if (existingContent) {
                    carousel.replaceChild(testimonialContent, existingContent);
                } else {
                    carousel.insertBefore(testimonialContent, carousel.firstChild);
                }
                
                // 更新指示器
                const dots = document.querySelectorAll('.carousel-dot');
                console.log("Updating indicators, found", dots.length, "dots");
                dots.forEach((dot, index) => {
                    if (index === currentTestimonialIndex) {
                        dot.classList.add('active');
                    } else {
                        dot.classList.remove('active');
                    }
                });
            }
            
            // 开始加载配置
            loadConfig();
        });
    </script>
</body>
</html> 